create database aula_normalizacao_e_denormalizacao;

-- Clientes
create table clientes (
  cliente_id    serial primary key,
  nome          text not null,
  email         text unique not null
);

-- Pedidos
create table pedidos (
  pedido_id     serial primary key,
  cliente_id    int not null references clientes(cliente_id),
  data_pedido   date not null,
  status        text not null
);

-- itens de pedido
create table itens_pedido (
  pedido_id     int not null references pedidos(pedido_id),
  produto_id    int not null,
  quantidade    int not null,
  preco_unit    numeric(10, 2) not null,
  primary key (pedido_id, produto_id)
);


-- ao cruzar 3 tabelas como vemos no select abaixo, pode 
-- ocasionar uim overhead (sobrecarga) em bases de grandes volumes
select
  c.cliente_id,
  c.nome,
  sum(i.quantidade * i.preco_unit) as valor_total
from clientes c
join pedidos p on p.cliente_id = c.cliente_id
join itens_pedido i on i.pedido_id = p.pedido_id
where p.data_pedido between '2025-01-01' and '2025-06-30'
group by c.cliente_id, c.nome;






create database sistema_biblioteca_universitaria;


-- criação das tabelas

-- 1. Autores
create table authors (
  author_id     serial primary key,
  first_name    varchar(50) not null,
  last_name     varchar(50) not null,
  birth_date    date
);

-- 2. Editoras
create table publishers (
  publisher_id    serial primary key,
  name            varchar(100) not null unique,
  address         text
);

-- 3. Gêneros
create table genres (
  genre_id     serial primary key,
  name         varchar(50) not null unique
);

-- 4. Livros
create table books (
  book_id         serial primary key,
  title           varchar(200) not null,
  author_id       int not null references authors(author_id),
  publisher_id    int not null references publishers(publisher_id),
  genre_id        int not null references genres(genre_id),
  pub_year        int,
  isbn            char(13) unique
);

-- 5. Unidades da Biblioteca
create table library_branches (
  branch_id      serial primary key,
  name           varchar(100) not null,
  address        text
);

-- 6. Cópias de livros
-- valores possíveis status: 'available', 'loaned', 'reserved', 'lost'.
create table book_copies (
  copy_id        serial primary key,
  book_id        int not null references books(book_id),
  branch_id      int not null references library_branches(branch_id),
  status         varchar(20) not null default 'available'
);


-- 7. Usuários (membros)
create table members (
  member_id          serial primary key,
  full_name          varchar(100) not null,
  email              varchar(100) unique not null,
  phone              varchar(20),
  membership_start   date not null,
  membership_end     date
);


-- 8. Empréstimos
create table loans (
  loan_id       serial primary key,
  copy_id       int not null references book_copies(copy_id),
  member_id     int not null references members(member_id),
  loan_date     timestamp not null default now(),
  due_date      date not null,
  return_date   date
);


-- 9. Reservas
-- valores possíveis status: 'active', 'fulfilled', 'cancelled'
create table reservations (
  reservation_id     serial primary key,
  copy_id            int not null references book_copies(copy_id),
  member_id          int not null references members(member_id),
  reservation_date   timestamp not null default now(),
  status             varchar(20) not null default 'active'
);

-- 10. Funcionários (Bibliotecários)
create table librarians (
  librarian_id      serial primary key,
  full_name         varchar(100) not null,
  email             varchar(100) unique not null,
  branch_id         int not null references library_branches(branch_id)
);